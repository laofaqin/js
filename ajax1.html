<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304452 (zh-CN, DDL); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2489"/>

<div>
<span><div><span style="font-family: 微软雅黑;">第一节 </span></div><ul><li><b><span style="font-family: 微软雅黑;">1 .ajax</span><span style="font-family: 微软雅黑;">的概念</span></b></li></ul><div style="margin-left:40px;">全称：Asynchronous(异步) Javascript And Xml</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">前端经常需要使用后端提供的接口获取数据，怎么向服务器请求数据呢，就是使用ajax</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">AJAX不是一种新的编程语言，而是一种用于创建更快更好以及交互性更强的WEB应用程序技术，该技术在98年前后得到了应用。</div><div style="margin-left:40px;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">通过AJAX，你的JS可以通过JS的XMLHttpRequest对象在页面不重载的情况下与服务器直接进行通信</span>。<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">这样可以在服务器请求到想要的数据，而不是整个页面</span>。AJAX的核心就是JS的<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">XMLHttpRequest</span>对象。xhr对象是在IE5中首次引入，它是一种支持<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">异步请求</span>的对象。</div><div style="margin-left:40px;"><br/></div><ul><li><b><span style="font-family: 微软雅黑;">2.ajax</span><span style="font-family: 微软雅黑;">的优势</span></b><ul><li>1：无刷新更新数据。（局部刷新）</li><li>2：异步与服务器通信。（不让界面卡顿）</li><li>3：基于标准被广泛支持。</li><li>4：界面与应用分离。（前后端分离）</li><li>5：节省带宽</li></ul></li></ul><div><br/></div><ul><li><b><span style="font-family: 微软雅黑;">3.</span><span style="font-family: 微软雅黑;">编写步骤</span></b></li></ul><div style="margin-left:120px;"><br/></div><div style="margin-left:160px;">所有现代浏览器(IE7+，chrome，firefox，opera，safari)均内建XMLHttpRequest对象。但是IE5、6使用ActiveXObject对象</div><div style="margin-left:160px;"><br/></div><div style="margin-left:160px;">1-创建XMLHttpRequest对象</div><div style="margin-left:160px;"><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); margin-left: 120px;"><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var xhr = null;</span></span></div><div>xhr = new XMLHttpRequest();</div></div><div style="margin-left:160px;">2-打开和服务器的连接</div><div style="margin-left:160px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); margin-left: 120px;"><div>//   url（接口）</div><div>var url = 'https://api.readhub.me/topic?lastCursor=40462&amp;pageSize=20'</div><div>xhr.open('GET', url);</div></div><div style="margin-left:160px;">3-发送请求</div><div style="margin-left:160px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); margin-left: 120px;"><div>//发送</div><div>xhr.send(null)</div></div><div style="margin-left:160px;">4-回调函数</div><div style="margin-left:160px;"><em style="font-style: normal; color: rgb(204, 0, 0); font-family: arial; font-size: 13px; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">xhr.onload</em><span style="color: rgb(51, 51, 51); font-family: arial; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"> 回调函数是在异步请求加载完成后所执行的函数,当JavaScript 监测到请求的数据全部传输完成后就会触发该函数</span></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); margin-left: 120px;"><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//指定回调函数，请求成功（回调）调用这个函数</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">xhr.onload</span></span><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">= function() {</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     </span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span></span></div><div>          if(xhr.status == 200) {</div><div>              //请求成功</div><div>              //console.log(xhr.responseText)</div><div>              var obj = JSON.parse(xhr.responseText)</div><div>              console.log(obj)</div><div>          }</div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div></div><div style="margin-left:160px;"><br/></div><div style="margin-left:160px;">完整的代码如下</div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); margin-left: 120px;"><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//发起 ajax</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//1.创建xmlhttprequest 对象</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var xhr = null;</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">if(window.ActiveXObject) {</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     xhr = new ActiveXObject(’Microsoft.XMLHTTP’);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">} else if(window.XMLHttpRequest) {</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     xhr = new XMLHttpRequest();</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//2. 打开链接   请求方式get</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//   url（接口）</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var url = 'https://api.readhub.me/topic?lastCursor=40462&amp;pageSize=20'</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">xhr.open('GET', url);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//3.发送</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">xhr.send(null);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//4.指定回调函数，请求成功（回调）调用这个函数</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">xhr.onload= function() {</span></span></div><div>          if(xhr.status == 200) {</div><div>              //请求成功</div><div>              //console.log(xhr.responseText)</div><div>              var obj = JSON.parse(xhr.responseText)</div><div>              console.log(obj)</div><div>          }</div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div></div><div style="margin-left:160px;"><br/></div><div style="margin-left:120px;"><br/></div><ul><li><b><span style="font-family: 微软雅黑;">4.</span><span style="font-family: 微软雅黑;">编写服务器接口</span></b></li></ul><div><b><br/></b></div><div><b>注意，在公司中我们的使用接口，都会有专门的接口文档，说明接口的功能和参数，格式如下</b></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>接口地址：http://127.0.0.1/mysql-api-username.php</div><div>接口功能：检测用户名是否存在</div><div>接口类型：get请求</div><div>接口参数：</div><div>          参数     是否必选  参数说明</div><div>         username   y       用户名</div><div>接口请求示例：http://127.0.0.1/mysql-api-username.php?username=张三</div><div>返回json数据：</div><div><br/></div><div>{</div><div>&quot;isExist&quot;:false//表示是否存在用户</div><div>}</div><div><br/></div><div><br/></div></div><div><br/></div><div>下面代码，使用php写了一个接口，返回了json数据，下面接口支持get请求，有一个参数username</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">&lt;?php</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">$dbhost = 'localhost:3306';  // mysql服务器主机地址</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">$dbuser = 'root';            // mysql用户名</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">$dbpass = '';          // mysql用户名密码</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">$conn = mysqli_connect($dbhost, $dbuser, $dbpass);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">if(! $conn )</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">{</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">  die('连接失败: ' . mysqli_error($conn));</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">// 设置编码，防止中文乱码</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">mysqli_query($conn , &quot;set names utf8&quot;);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">$findUsername =$_GET['username'];</span></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//$findUsername = '张三22';</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//编写sql语句</span></span></div><div align="left" style="min-height: 16pt;"><div><br/></div></div><div align="left" style="min-height: 16pt;"><div><font color="#F8F8F2" face="consolas" size="4"><span style="font-size:14pt; background:#49483e">$sql</span></font> <font color="#F92672" face="consolas" size="4"><span style="font-size:14pt; background:#49483e">=</span></font> <font color="#E6DB74" face="consolas" size="4"><span style="font-size:14pt; background:#49483e">&quot;SELECT  *  FROM  student WHERE student.username='</span></font><font color="#F8F8F2" face="consolas" size="4"><span style="font-size:14pt; background:#49483e">$</span></font><font color="#E6DB74" face="consolas" size="4"><span style="font-size:14pt; background:#49483e">findUsername'&quot;</span></font><font color="#F8F8F2" face="consolas" size="4"><span style="font-size:14pt; background:#49483e">;</span></font></div></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"> //选择要查询的数据库名称</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">mysqli_select_db( $conn, 'db1' );</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//查询数据</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">$retval = mysqli_query( $conn, $sql );</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">if(! $retval )</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">{</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    die('无法读取数据: ' . mysqli_error($conn));</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//echo json_encode(mysqli_fetch_all($retval,MYSQLI_ASSOC));</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">// 把 所有的查询结果转为数组</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">$res = mysqli_fetch_all($retval,MYSQLI_ASSOC);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">if(count($res)){</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    $arr['isExist'] = true;</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}else{</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    $arr['isExist'] = false;</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//返回json数据</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">echo json_encode($arr);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">mysqli_close($conn);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">?&gt;</span></span></div></div><div><b><br/></b></div><div><b><br/></b></div><div><span style="font-family: 微软雅黑;"><br/></span></div><div><font face="微软雅黑">强化练习</font></div><ol><li><span style="font-family: 微软雅黑;">验证用户名是否存在（使用php写接口）</span></li></ol><div><span style="font-family: 微软雅黑;"><a href="ajax-1_files/Attachment.pdf"><img src="ajax-1_files/f0b9cc60675e7bf34e0d372c78e52af2.png" alt="Attachment.pdf"></a></span></div><ol><li><span style="font-family: 微软雅黑;">搜索下拉提示</span></li></ol><div>使用接口，可以</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div>//keyword 字段是要搜索的词</div><div>var url2 = 'http://cangdu.org:8001/v1/pois?city_id=1&amp;keyword=迪士尼&amp;type=search'</div></div><div><br/></div><div><span style="font-family: 微软雅黑;"><a href="ajax-1_files/Attachment.pdf"><img src="ajax-1_files/7bba593881d8081be2f1a95b79375662.png" alt="Attachment.pdf"></a></span></div><div><span style="font-family: 微软雅黑;"><br/></span></div><div><span style="font-weight: bold; font-family: 微软雅黑;">第三节：</span></div><ul><li><span style="font-family: 微软雅黑;">局部数据刷新<br/>
使用ajax技术，在页面不重新加载的情况下，只更新部分内容</span></li><li><span style="font-family: 微软雅黑;">事件委托的应用<br/>
给未来元素添加事件<br/></span></li><li><span style="font-family: 微软雅黑;">前后端分离<br/></span><span style="font-family: 微软雅黑;">后端提供数据，前端负责页面上所有的显示和行为</span></li></ul><div><span style="font-family: 微软雅黑;"><span style="font-weight: bold; font-family: 微软雅黑;"> </span><span style="font-weight: bold; font-family: 微软雅黑;">第四节：强化练习</span></span></div><ol><li><div><span style="font-family: 微软雅黑;">加载更多</span></div></li></ol><div><br/></div></span>
</div></body></html> 