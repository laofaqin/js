<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304452 (zh-CN, DDL); Windows/6.3.9600 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2493"/>

<div>
<span><div><span style="font-weight: bold; font-family: 微软雅黑;">第一节：</span></div><ul><li><b><span style="font-family: 微软雅黑;">回调函数</span></b></li></ul><div>封装ajax函数，我们就可以多次使用ajax功能，而不用重复的写创建xhr的代码。</div><div>我们每次调用ajax函数都会获取到数据，每次请求到数据，都需要对数据进行加工处理，显示在页面上。比如，登录的是时候调用登录接口，成功以后可能是跳转到首页。而请求新闻列表接口以后我们要把数据显示在列表上。所以我们可以再每次请求的时候，设置回调函数，在回调函数中获取数据！</div><div>代码如下</div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function ajax(url, callbackfn) {</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var xhr = new XMLHttpRequest();</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    xhr.open('get', url);</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    xhr.send(null)</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    xhr.onload= function() {</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">         </span></span></div><div>          if(xhr.status == 200) {</div><div>                 var obj = JSON.parse(xhr.responseText)</div><div>                 //回调函数</div><div>                 callbackfn(obj);</div><div><br/></div><div>             }</div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><br/></span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">ajax(url1,function(obj){</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     console.log(obj)</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">});</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">ajax(url2,function(obj1){</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     console.log(obj1)</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">})</span></span></div></div><div><br/></div><ul><li><b><span style="font-family: 微软雅黑;">ajax</span><span style="font-family: 微软雅黑;">的依赖调用</span></b></li></ul><div>思考一个问题，如果想让两个请求有顺序该怎么做？</div><div>比如登录成功（调用登录接口）以后，我们才能获取这个用户的相关的信息（调用获取用户信息接口）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div>//登录</div><div>ajax(loginAPi,function(obj){</div><div>     console.log(obj)</div><div>     //获取用户信息</div><div style="margin-left:40px;">ajax(getUserInfoAPi,function(obj1){</div><div style="margin-left:40px;">     console.log(obj1)</div><div style="margin-left:40px;">})</div><div>});</div><div><br/></div></div><div><b><br/></b></div><ul><li><b><span style="font-family: 微软雅黑;">Promise</span><span style="font-family: 微软雅黑;">介绍</span></b></li></ul><div><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">对象</span></div><div><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">ES6 规定，</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">对象是一个构造函数，用来生成</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">实例。</span></div><div><font color="#333333" face="Verdana, Arial">我们先来看看它的使用方法</font></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">const promise = new Promise(function(resolve, reject) {</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">// ... some code  这里写异步操作代码</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">   ajax(api1,function(res){</span></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">         // </span></span><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">异步操作成功,请求数据成功</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          resolve(value);//将promise设置为</span></span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">resolved（完成状态）</code></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">   },function(error){</span></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">         </span></span><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">// </span></span><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">异步操作失败,请求数据失败</span></span></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          reject(error);//</span></span><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//将promise设置为</span></span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">rejected</code> <code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">（失败状态）</code></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">   })<br/></span></span></div><div><br/></div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">});</span></span></div></div><div><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">resolve</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">函数的作用是</span> <span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；</span></div><div><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">reject</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">函数的作用是</span> <span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去</span></div><div><span style="font-family: Verdana, Arial;"><span style="color: rgb(51, 51, 51);"><br/></span></span></div><div><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">实例生成以后，可以用</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">then</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">方法分别指定</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">resolved</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">状态和</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">rejected</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">状态的回调函数。</span></div><div><span style="font-family: Verdana, Arial;"><span style="color: rgb(51, 51, 51);"><br/></span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div>promise.then(function(value) {<br/>
// success<br/>
}, function(error) {<br/>
// failure<br/>
});</div></div><div><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">then</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">方法可以接受两个回调函数作为参数。第一个回调函数是</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">对象的状态变为</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">resolved</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">时调用，第二个回调函数是</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">对象的状态变为</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">rejected</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">时调用。其中，第二个函数是可选的，不一定要提供。这两个函数都接受</span><code style="font-family: Consolas, 'Courier New', Courier, FreeMono, monospace; color: rgb(199, 37, 78); font-weight: 400; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; padding-left: 3px; padding-right: 3px; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: initial initial; background-repeat: initial initial;">Promise</code><span style="color: rgb(51, 51, 51); font-family: Verdana, Arial; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; float: none; display: inline !important;">对象传出的值作为参数。</span></div><div><span style="font-family: Verdana, Arial;"><span style="color: rgb(51, 51, 51);"><br/></span></span></div><div>上面代码也可成如下形式</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>promise.then(function(value) {</div><div>// success </div><div>}).catch(function(error){</div><div>     //error</div><div>})</div></div><div><br/></div><div><font color="#333333" face="Verdana, Arial">在success 里面我们可以发起第二个请求</font></div><div><span style="font-family: Verdana, Arial;"><span style="color: rgb(51, 51, 51);"><br/></span></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>promise.then(function(value) {</div><div>// success</div><div>     ajax(api2,function(res){</div><div>          </div><div>     })</div><div>}).catch(function(error){</div><div>     //error</div><div>})</div></div><div><span style="font-family: Verdana, Arial;"><span style="color: rgb(51, 51, 51);"><br/></span></span></div><div>这个时候我们的两个请求明显的就有顺序</div><div><br/></div><div>像是这样  new Promise(ajax1).then(ajax2).catch() ，使用了链式调用代替了嵌套结构，这样就避免了层层嵌套使的代码可读性太差！</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-family: 微软雅黑;">第二节：强化练习</span></div><ul><li><span style="font-family: 微软雅黑; font-weight: bold;">掌握</span><span style="font-family: 微软雅黑; font-weight: bold;">ajax</span><span style="font-family: 微软雅黑; font-weight: bold;">依赖调用</span></li><li><span style="font-family: 微软雅黑; font-weight: bold;">掌握回调函数的应用</span></li><li><span style="font-family: 微软雅黑; font-weight: bold;">掌握</span><span style="font-family: 微软雅黑; font-weight: bold;">Promise</span><span style="font-family: 微软雅黑; font-weight: bold;">规范</span></li></ul><div><span style="font-weight: bold; font-family: 微软雅黑;"><br/></span></div><div><span style="font-weight: bold; font-family: 微软雅黑;">第三节： </span></div><ul><li><span style="font-family: 微软雅黑; font-weight: bold;">ajax</span><span style="font-family: 微软雅黑; font-weight: bold;">的同源策略</span></li></ul><div>同源策略(same origin policy)是一种约定，即只有本网站的网页上才能使用本网站的接口</div><div>所谓同源：是指协议、域名、端口都相同</div><div><br/></div><div>比如你们公司的网站是www.xx.com,在你们的网站的页面上使用www.yy.com的接口是不被允许的！</div><div>想想问为什么不同源，不允许这样？如果你们公司的服务器（每年花费成本维护），别人公司在使用并且赚了钱，你们公司会愿意吗？！@#！@#</div><div><br/></div><div>所以就有了同源策略，这个策略是由netscape公司引入浏览器的，他是浏览器最核心最基本的安全功能。现在所有支持JS的浏览器都会使用这个策略。</div><div><br/></div><ul><li><span style="font-family: 微软雅黑; font-weight: bold;">jsonp</span><span style="font-family: 微软雅黑; font-weight: bold;">跨域</span></li></ul><div>事情的发展总是不如人愿，那群挑事的公司又在抱怨：我们公司的服务器就是想让别人用（靠什么赚钱？你懂得，用的人多了自热能赚钱）！！@#！@# </div><div>怎么会有这样的公司呢？百度，谷歌，这些公司的搜索窗口会出现很多公司的网站。</div><div>去看看duba.com, 哪个公司出钱多，他的默认搜索引擎就是哪个公司！</div><div><br/></div><div>同源策略的限制，使得他们要想想方设法要<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">跨域</span>！即域名不同，别人也能使用你们的接口！这个技术就是<span style="font-family: 微软雅黑; font-weight: bold;">jsonp</span><span style="font-family: 微软雅黑; font-weight: bold;">跨域，</span>JSONP = JSON WITH PADDING，就是把json数据装在内部。</div><div><br/></div><div>我们发现凡是拥有src这个属性的标签都拥有跨域的能力，如img，script。那我们就可以把数据装载到JS文件内，供客户端调用和进一步处理。</div><div>想一想，你的网站可以使用别人网站的图片吗？可以使用别人网站的js吗？ 可以的。</div><div><br/></div><div>整个过程像是这样的，a公司网站上放了一个js文件，a.js,内容如下</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>func({name:&quot;张三&quot;,age:18});</div></div><div><br/></div><div>b公司的网页引入了这个a.com/a.js</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;script src=&quot;a.com/a.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</div></div><div><br/></div><div>我们会发现，a.js在调用func这个函数，b公司的网页没有这个函数，就会报错。但是如果b公司实现了个函数呢</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;script src=&quot;a.com/a.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;<br/></div><div>&lt;script type=&quot;text/javascript&quot;&gt;</div><div>              function func(obj){</div><div><br/></div><div>              }</div><div>&lt;/script&gt;</div></div><div>这样就不会报错了，并且a公司的网页上拿到了b的数据！ 这就是jsonp 跨域！</div><div><br/></div><div>在实际使用中，具体步骤如下</div><div>1：定义一个回调函数（全局函数）。 （回调函数的名称要看a公司的规定）</div><div>2：创建script标签，指定src地址（b公司的接口），并添加到（a公司）页面中。</div><div>注：一般来说src必须跟着一个参数callback来指定回调函数名称</div><div><span style="color: rgb(51, 51, 51);"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="font-size: 12px;"><br/></span></span></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>/定义回调函数</div><div>window.fn = function(res) {</div><div>     </div><div>}</div><div>//创建script标签<br/></div><div>var sc = document.createElement('script')</div><div>sc.src = api;</div><div>document.body.appendChild(sc)；</div></div><div><br/></div><div><br/></div><ul><li><span style="font-family: 微软雅黑; font-weight: bold;">服务器端跨域</span></li></ul><div>CORS是一个W3C标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</div><div>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。整个CORS通信过程，都是浏览器自动完成，不需要用户参与!</div><div><br/></div><div>readhub.me网站的接口就支持 跨域！</div><div><br/></div><ul><li><span style="font-family: 微软雅黑; font-weight: bold;">get</span><span style="font-family: 微软雅黑; font-weight: bold;">和</span><span style="font-family: 微软雅黑; font-weight: bold;">post</span></li></ul><div>1.GET请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，参数之间以&amp;相连。</div><div>2.POST把提交的数据则放置在是HTTP包的包体中。</div><div>3：数据大小</div><div>GET请求传送的数据量比较小，最大2KB，这个受浏览器的限制。而POST请求传送的数据量比较大，一般默认为不受限制。其实大小受服务器的限制。</div><div>4：安全性</div><div>GET安全性非常低，POST的安全性较高。</div><div><br/></div><div>下面是使用xhr，发送post请求的方法</div><div>使用send（'lastCursor=40462&amp;pageSize=20 '）设置请求体的内容</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>//发起 ajax</div><div>//1.创建xmlhttprequest 对象</div><div>var xhr = new XMLHttpRequest();</div><div>//2. 打开链接   请求方式  post</div><div>var url = 'http://127.0.0.1/bk/mysql-api-username.php'</div><div>xhr.open('POST', url);</div><div><br/></div><div>//3.发送</div><div><br/></div><div>//post  模拟表单的 需要增加请求头</div><div>xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')</div><div><br/></div><div>//get 请求 参数在url中</div><div>//post 请求参数  body中</div><div>//post参数如下形式</div><div>//lastCursor=40462&amp;pageSize=20</div><div><br/></div><div>var pa = 'username=张三';</div><div>xhr.send(pa);//设置请求体的内容</div><div><br/></div><div>//指定回调函数，请求成功（回调）调用这个函数</div><div>//请求耗时操作</div><div>xhr.onreadystatechange = function() {</div><div>     console.log(111, xhr.readyState)</div><div>      if(xhr.status == 200) {</div><div>              //请求成功</div><div>              //console.log(xhr.responseText)</div><div>              var obj = JSON.parse(xhr.responseText)</div><div>              console.log(obj)</div><div>          }</div><div>     </div><div><br/></div><div>}</div></div><div><br/></div><div>接口文件如下</div><div>mysql-api-username.php  </div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;?php</div><div><br/></div><div>header('Access-Control-Allow-Origin:*');</div><div>//只需要在服务器上设置一句话，就可让接口支持服务器跨域</div><div><br/></div><div>$dbhost = 'localhost:3306';  // mysql服务器主机地址</div><div>$dbuser = 'root';            // mysql用户名</div><div>$dbpass = '';          // mysql用户名密码</div><div>$conn = mysqli_connect($dbhost, $dbuser, $dbpass);</div><div>if(! $conn )</div><div>{</div><div>  die('连接失败: ' . mysqli_error($conn));</div><div>}</div><div>// 设置编码，防止中文乱码</div><div>mysqli_query($conn , &quot;set names utf8&quot;);</div><div>$findUsername =$_REQUEST['username'];</div><div>//$findUsername = '张三22';</div><div><br/></div><div>//编写sql语句</div><div>$sql = &quot;SELECT  *  FROM  student WHERE student.username='$findUsername'&quot;;</div><div> //选择要查询的数据库名称</div><div>mysqli_select_db( $conn, 'db1' );</div><div>//查询数据</div><div>$retval = mysqli_query( $conn, $sql );</div><div>if(! $retval )</div><div>{</div><div>    die('无法读取数据: ' . mysqli_error($conn));</div><div>}</div><div><br/></div><div>//echo json_encode(mysqli_fetch_all($retval,MYSQLI_ASSOC));</div><div>// 把 所有的查询结果转为数组</div><div>$res = mysqli_fetch_all($retval,MYSQLI_ASSOC);</div><div>if(count($res)){</div><div>     $arr['isExist'] = true;</div><div>}else{</div><div>     $arr['isExist'] = false;</div><div>}</div><div>//返回json数据</div><div>echo json_encode($arr);</div><div><br/></div><div>mysqli_close($conn);</div><div>?&gt;</div></div><div><br/></div><div><span style="font-weight: bold; font-family: 微软雅黑;"><br/></span></div><div><span style="font-weight: bold; font-family: 微软雅黑;">第四节：强化练习</span></div><ul><li><span style="font-family: 微软雅黑; font-weight: bold;">请求自己写的post接口</span></li><li><span style="font-family: 微软雅黑; font-weight: bold;">请求百度搜索下拉提示（</span><span style="font-family: 微软雅黑; font-weight: bold;">jsonp</span> <span style="font-family: 微软雅黑; font-weight: bold;">）</span></li></ul><div><span style="font-weight: bold; font-family: 微软雅黑;"><br/></span></div><div><font face="微软雅黑"><b>第五节：强化练习</b></font></div><div><span style="font-family: 微软雅黑;">京东商品评论列表（jsonp）</span></div><div><a href="ajax-2_files/Attachment.pdf"><img src="ajax-2_files/745e320e7d455c47cd1a0109d5316f0f.png" alt="Attachment.pdf"></a></div><div><br/></div></span>
</div></body></html> 